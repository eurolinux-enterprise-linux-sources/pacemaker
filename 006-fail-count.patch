From cdbc6bfc8995ecc86da3fe81a463d8fc4ce1f8fd Mon Sep 17 00:00:00 2001
From: Hideo Yamauchi <renayama19661014@ybb.ne.jp>
Date: Mon, 30 Jul 2018 07:33:09 +0900
Subject: [PATCH] Mid: controld: No update by already confirmed events.

---
 crmd/te_events.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/crmd/te_events.c b/crmd/te_events.c
index 7b5ca2a..1f7a34c 100644
--- a/crmd/te_events.c
+++ b/crmd/te_events.c
@@ -510,6 +510,14 @@ process_graph_event(xmlNode *event, const char *event_node)
             abort_transition(INFINITY, tg_restart, "Unknown event", event);
 
         } else {
+
+            /* Actions already confirmed skip matching. */
+            /* ex. Ignoring xxx_last_0 or xxx_last_failure_0 generated by create_operation_update() in order to prevent duplicate fail-count from increasing. */
+            if (action->confirmed == TRUE) {
+                crm_log_xml_debug(event, "No update by already confirmed events :");
+                goto bail;
+            }
+
             ignore_failures = safe_str_eq(
                 crm_meta_value(action->params, XML_OP_ATTR_ON_FAIL), "ignore");
             match_graph_event(action, event, status, rc, target_rc, ignore_failures);
-- 
1.8.3.1

