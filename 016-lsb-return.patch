From fe50b4234ece7c842b2cdec9e6d7a08060c4b0a1 Mon Sep 17 00:00:00 2001
From: Klaus Wenninger <klaus.wenninger@aon.at>
Date: Tue, 26 Jul 2016 14:38:36 +0200
Subject: [PATCH] Low: LSB init: try to be a little more compliant

---
 lrmd/pacemaker_remote.in | 7 ++++++-
 mcp/pacemaker.in         | 5 +++++
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/lrmd/pacemaker_remote.in b/lrmd/pacemaker_remote.in
index 6f79fae..13abba1 100644
--- a/lrmd/pacemaker_remote.in
+++ b/lrmd/pacemaker_remote.in
@@ -48,9 +48,14 @@ failure()
 status()
 {
 	pid=$(pidof $1 2>/dev/null)
-	rtrn=$?
+	local rtrn=$?
 	if [ $rtrn -ne 0 ]; then
 		echo "$1 is stopped"
+		if [ -f "@localstatedir@/run/$prog.pid" ]; then
+			rtrn=1
+		else
+			rtrn=3
+		fi
 	else
 		echo "$1 (pid $pid) is running..."
 	fi
diff --git a/mcp/pacemaker.in b/mcp/pacemaker.in
index 6e90645..90335db 100644
--- a/mcp/pacemaker.in
+++ b/mcp/pacemaker.in
@@ -62,6 +62,11 @@ status()
 	local rtrn=$?
 	if [ $rtrn -ne 0 ]; then
 		echo "$1 is stopped"
+		if [ -f "@localstatedir@/run/$prog.pid" ]; then
+			rtrn=1
+		else
+			rtrn=3
+		fi
 	else
 		echo "$1 (pid $pid) is running..."
 	fi
-- 
1.8.3.1

